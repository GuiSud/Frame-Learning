(()=>{var t,e;t=window,e=document,window.AudioMap=function(i){const{timeUpdate:a,playDone:n,delay:s,src:o,playInit:r}={delay:26,timeUpdate:()=>{},playDone:()=>{},playInit:()=>{},...i},d=(i=>{let a={};const n=document.createElement("canvas");let s=n.getContext("2d");n.innerText="您的浏览器不支持该插件，请切换到谷歌浏览器获得最佳体验！",n.id="canvas",e.body.appendChild(n),r(a,s);let o=null;function r(e,i){let a=t.innerWidth,s=t.innerHeight;n.width=a,n.height=s,e.w=a,e.h=s,e.canvas=n,e.ctx=i;let o=i.createLinearGradient(a/2,300,a/2,s/2);o.addColorStop(1,"#473B7B"),o.addColorStop(.5,"#3584A7"),o.addColorStop(0,"#30D2BE"),i.fillStyle=o}return t.addEventListener("resize",(()=>{o&&clearTimeout(o),o=setTimeout((()=>{r(a,s)}),i)})),a})(s),l=new AudioContext,u=l.createAnalyser(),h=document.createElement("audio");this.audio=h,this.context=l,this.playing=!1,this.audio.src=o||"null",this.playInit=r,this.audio.addEventListener("timeupdate",a),this.audio.addEventListener("ended",n);const c=l.createMediaElementSource(this.audio);c.connect(u),c.connect(l.destination),this.audio.addEventListener("canplay",(({target:t})=>{const{currentTime:e,duration:i}=t;this.playInit(this),this.currentTime=e,this.duration=i,this.canplay=!0,this.audioCallBack&&this.audioCallBack(this),this.audioError=!1})),this.audio.addEventListener("ended",(()=>{this.playing=!1})),this.audio.addEventListener("error",(({target:t})=>{this.audioError=!0}));let p=null;!function(){const{canvas:t,ctx:e,w:i,h:a}=d;let n=Math.round(i/17);const s=new Uint8Array(u.frequencyBinCount);u.getByteFrequencyData(s),e.clearRect(0,0,i,a);let o=Math.round(s.length/n);for(let t=0;t<n;t++)e.fillRect(i/2+10*t,a/2,7,-s[o*t]),e.fillRect(i/2-10*t,a/2,7,-s[o*t]);p=window.requestAnimationFrame(arguments.callee)}(),this.play=t=>{if(this.audioError)throw t&&t({state:0,msg:"请先设置路径之后播放！"}),new Error("请先设置路径之后播放！");this.canplay?(this.context.resume(),this.audio.paused?(t({state:1,msg:"开始播放"}),this.audio.play(),this.playing=!0):(t({state:2,msg:"暂停播放"}),this.audio.pause(),this.playing=!1)):setTimeout((()=>{this.play()}),16)},this.pause=()=>{this.audio.pause(),this.playing=!1},this.setSrc=(t="../audio/嚣张.mp3",e)=>(this.canplay=!1,this.playing=!1,this.audioError=!1,this.audio.setAttribute("src",t),this.audioCallBack=e,this),this.setVolume=t=>{if(!((t=parseFloat(t))>=0&&t<=1))throw Error("音量设置在 0 - 1 之间");this.audio.volume=t}}})();